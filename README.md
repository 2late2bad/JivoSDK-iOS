# **Jivo Mobile SDK для iOS (beta)**

## **Актуальная версия: 1.5.1**

### Список изменений:
- исправлены баги с отображением ячеек в ленте чата, когда бабблы сообщений наползали друг на друга, либо наоборот имели слишком большие отступы;
- исправлен баг с пагинацией, когда при загрузке и отображении серии предыдущих сообщений часть из них помещалась в самый низ ленты чата;
- исправлен баг с отображением клавиатуры при анимированном появлении view экрана чата, когда клавиатура закрывала собой часть панели ввода. Это происходило, например, при использовании семейства методов **place**, объявленных в **IJivoSDKChattingUI**, для отображения экрана чата.

Список изменений предыдущих версий вы можете найти [здесь](https://docs.google.com/document/d/1NEFVaK97jw559PfP1QsS6HGSE91y4yI3chp84zInIT0/edit?usp=sharing).

**Jivo SDK** – это фреймворк для интеграции бизнес-чата Jivo в ваше приложение.

Размер бинарного файла **Jivo SDK** для архитектур девайсов составляет приблизительно **4 МБ**. Размер **dSYMs** для фреймворка составляет приблизительно **8,9 МБ**.

Для работы с фреймворком вам доступны API на следующих языках (платформах):
- Swift;
- Objective-C;
- JavaScript (React Native).

На данный момент Jivo SDK **НЕ** поддерживает **bitcode**.

Сейчас Jivo SDK поддерживает следующие языки:
- русский;
- английский;
- испанский;
- португальский;
- турецкий.

Часть разделов этого документа имеют адаптированные версии с инструкциями по интеграции Jivo SDK в React Native проекты. Адаптированные разделы вы можете найти здесь. Остальные разделы этого документа по-прежнему актуальны для React Native.

## Установка
### Для React Native
Инструкцию по установке Jivo SDK в React Native проект вы можете найти в разделе “Установка” здесь. Остальные разделы этого документа при отсутствии ссылки на адаптированную версию актуальны и для React Native проектов.
Для нативных проектов

### CocoaPods 
#### Требования
Для установки Jivo SDK в свой проект Xcode вам потребуется: 
- Xcode 12.0 или новее; 
- CocoaPods 1.10.0 или новее (проверить версию CocoaPods можно, выполнив следующую команду в терминале: `$ pod --version`); 
- настроить deployment target на iOS версии 11.0 или более новую.

#### Шаги установки
1. Укажите в Podfile своего проекта следующие источники для pod'ов: 
```ruby
source 'https://github.com/CocoaPods/Specs.git' 
source 'https://github.com/JivoChat/JMSpecsRepo.git'
```

2. Укажите JivoSDK как зависимость в вашем Podfile:
```ruby
use_frameworks!

target :YourTargetName do 
  pod 'JivoSDK', ‘~> 1.5’ 
end
```

3. Добавьте post-install блок в свой Podfile:
```ruby
post_install do |installer| 
  installer.pods_project.targets.each do |target| 
    target.build_configurations.each do |config| 
      config.build_settings['BUILD_LIBRARY_FOR_DISTRIBUTION'] = 'YES' 
    end 
  end 
end
```

> Блок post-install добавляет поддержку module stability для всех pod'ов в вашем проекте. Это необходимо для того, чтобы один и тот же пакет JivoSDK.xcframework можно было использовать, не пересобирая на всех версиях Xcode выше 12.0 (версия, на которой JivoSDK.xcframework был собран). Корректная работа JivoSDK возможна только в том случае, если все его зависимости также будут поддерживать module stability.

4. Выполните в терминале команду: 
```bash
$ pod install
```

## Настройка

Для полноценной работы JivoSDK необходимо сделать ещё несколько вещей.

### 1. Разрешения приложения 

JivoSDK использует камеру устройства. Также ему необходим доступ к фотогалерее. Для получения необходимых разрешений добавьте соответствующие ключи в файл Info.plist вашего проекта:
- для получения доступа к камере устройства добавьте ключ `NSCameraUsageDescription` и значение для него; 
- для получения доступа к фото галерее на устройстве добавьте ключ `NSPhotoLibraryUsageDescription` и значение для него.

### 2. Настройка PUSH-уведомлений

> PUSH-уведомления не работают в sandbox окружении, иными словами, вы не сможете проверить работу уведомлений в debug-сборке вашего приложения. Протестировать работу PUSH-уведомлений возможно только в release-сборке, загруженной в AppStore (TestFlight).

1. В настройках проекта во вкладке Signing & Capabilities добавьте новую возможность (capability) – Background Modes, и в появившемся разделе отметьте пункт Remote notifications; 
2. в той же вкладке добавьте новую возможность (capability) – Push Notifications; 
3. наши PUSH-уведомления используют [локализацию на стороне клиента](https://developer.apple.com/documentation/usernotifications/setting_up_a_remote_notification_server/generating_a_remote_notification). В теле уведомления для заголовка и сообщения PUSHа указаны ключи локализации. Добавьте в файлы локализации *.strings вашего проекта строки для следующих ключей:
- JV_MESSAGE_TITLE – ключ заголовка PUSHа; 
- JV_MESSAGE – ключ сообщения PUSHа.

Помимо ключей в теле PUSH-уведомления мы передаём ещё и аргументы, которые вы также можете использовать при локализации текста PUSHа: 
- первый аргумент содержит имя пользователя, который отправил сообщение;
- второй аргумент содержит текст сообщения.

Вот пример того, как может выглядеть локализация текста PUSH-уведомления в файле локализации *.strings для русского языка: 
```
"JV_MESSAGE_TITLE" = "Поддержка"; 
"JV_MESSAGE" = "%1$@: %2$@"; // '%1$@' и '%2$@' - это плейсхолдеры для аргументов PUSH-уведомления
```

4. добавьте ключ для Apple Push Notifications service (APNs) в разделе Keys на странице своего аккаунта в developer.apple.com (или используйте уже существующий ключ APNs);
5. передайте нам созданный ключ, а также: 
- key_id; 
- bundle_id; 
- team_id. 
> Для передачи ключа APNs вместе с дополнительными данными свяжитесь с нами.

### 3. Настройка канала в Jivo 

Для работы JivoSDK вам необходим канал специального типа – mobile SDK. Пока что его нельзя создать в личном кабинете Jivo. Для создания канала с типом mobile SDK или смены типа уже существующего канала на данный тип `свяжитесь с нами`.
